USE [Moderna]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET NOCOUNT ON
GO

CREATE TRIGGER [dbo].[INSERT_COMPROBANTE_AUDIT] ON [dbo].[COMPROBANTE]
AFTER INSERT, UPDATE
AS

DECLARE @p1 TABLE (col VARCHAR(30))

INSERT INTO COMPROBANTE_AUDIT
							(COMPROBANTE_ID
							, FECHA
							, CLAVE
							, NUMERO_CONSECUTIVO
							, IS_CORRECTO
							, ERROR)
(SELECT
	ID
	, GETDATE()
	, CLAVE
	, NUMERO_CONSECUTIVO
	, (CASE WHEN ERROR IS NULL THEN 1 ELSE 0 END)
	,  ERROR
FROM 
	inserted)


SELECT 
	* 
FROM 
	@p1

GO


