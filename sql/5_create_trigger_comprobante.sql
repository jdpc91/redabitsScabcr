USE [Moderna]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE [object_id] = OBJECT_ID(N'[dbo].[INSERT_COMPROBANTE_AUDIT]') AND [type] = 'TR')
BEGIN
	DROP TRIGGER [dbo].[INSERT_COMPROBANTE_AUDIT];
END
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET NOCOUNT ON
GO

CREATE TRIGGER [dbo].[INSERT_COMPROBANTE_AUDIT] ON [dbo].[COMPROBANTE]
AFTER INSERT, UPDATE
AS

DECLARE @p1 TABLE (col VARCHAR(30))

INSERT INTO COMPROBANTE_AUDIT
							(COMPROBANTE_ID
							, FECHA
							, CLAVE
							, NUMERO_CONSECUTIVO
							, IS_CORRECTO
							, ERROR)
SELECT
	ID
	, GETDATE()
	, CLAVE
	, NUMERO_CONSECUTIVO
	, IIF (ERROR IS NULL OR ERROR = '', 1, 0)
	,  ERROR
FROM 
	inserted


SELECT 
	* 
FROM 
	@p1

GO


